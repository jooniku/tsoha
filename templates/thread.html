{% extends "base.html" %}

{% block title %}Thread {{ thread.title }}{% endblock %}

{% block content %}
  <h2>{{ thread.title }}</h2>

  {% for post in posts %}
  {% set indent = indent_levels[post.id] %}

    <div style="margin-left: {{ indent * 30 }}px; border-left: 1px solid #ccc; padding-left: 10px;">
      <p>
        {% if post.deleted %}
          [deleted]
        {% else %}
          <a href="/user/{{ post.username }}">{{ post.username }}</a> ({{ post.created_at }}):
          <br>
          {{ post.content }}
          {% if post.edited %}
            <br><small><em>Edited on {{ post.edit_time }}</em></small>
          {% endif %}
        {% endif %}
      </p>

      <p>
        {% if session.user_id and not post.deleted %}
          <form method="get" action="{{ url_for('show_thread', thread_id=thread.id) }}" style="display:inline;">
            <input type="hidden" name="reply_to" value="{{ post.id }}">
            <button type="submit" class="btn btn-primary">Reply</button>
          </form>
        {% endif %}
        {% if post.user_id == session.user_id and not post.deleted %}
          <form action="/edit/{{ post.id }}" method="get" style="display:inline;">
            <button type="submit" class="btn btn-warning">Edit</button>
          </form>

          <form action="/remove/{{ post.id }}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger">Delete post</button>
          </form>
        {% endif %}
      </p>

      {% if request.args.get('reply_to') and request.args.get('reply_to')|int == post.id %}
        <form action="/reply/{{ post.id }}" method="post" style="margin-top:10px;">
          <textarea name="content" rows="3" cols="50" placeholder="Write your reply..." required></textarea><br>
          <button type="submit" class="btn btn-success">Send Reply</button>
        </form>
      {% endif %}
    </div>
    <hr />
  {% endfor %}
{% endblock %}
